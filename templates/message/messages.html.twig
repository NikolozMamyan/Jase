{% extends 'base.html.twig' %}

{% block body %}
<div class="container">
    <div class="row">
        <div class="col-md-4">
           <h3>Contacts</h3>
            <ul class="list-group">
                 {% for contact in app.user.followers %}
                    <li class="list-group-item">
                         <a href="{{ path('app_messages_between', {id: contact.follower.id}) }}">
                            <img src="https://via.placeholder.com/50" class="rounded-circle me-3" alt="Avatar">
                            {{ contact.follower.firstName }} {{ contact.follower.lastName }}
                        </a>
                    </li>
                {% else %} 
                    <li class="list-group-item">Aucun contact</li>
                 {% endfor %} 
            </ul>
        </div>
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5>Chat avec {{ otherUser.firstName }} {{ otherUser.lastName }}</h5>
                </div>
                <div class="card-body chat-box" id="chatBox">
                    {% for message in messages %}
                        <div class="message {% if message.sender == app.user %}sent{% else %}received{% endif %}">
                            <div class="message-content">
                                {{ message.content }}
                            </div>
                            <div class="message-timestamp">
                                {{ message.sentAt|date('H:i') }}
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="card-footer">
                    {{ form_start(form) }}
                        <div class="input-group">
                            {{ form_widget(form.content, {'attr': {'class': 'form-control', 'placeholder': 'Tapez votre message...'}}) }}
                            <button class="btn btn-primary" type="submit">Envoyer</button>
                        </div>
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.chat-box {
    max-height: 500px;
    overflow-y: auto;
    padding: 10px;
    background: #f8f9fa;
}

.message {
    margin-bottom: 10px;
    display: flex;
    flex-direction: column;
}

.message.sent {
    align-items: flex-end;
}

.message.received {
    align-items: flex-start;
}

.message-content {
    padding: 10px;
    border-radius: 10px;
    background: #007bff;
    color: white;
    max-width: 60%;
}

.message.sent .message-content {
    background: #dc3545;
}

.message-timestamp {
    font-size: 0.8rem;
    color: #6c757d;
    margin-top: 5px;
}
</style>
{% endblock %}
