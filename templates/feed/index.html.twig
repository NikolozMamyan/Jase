{% extends 'base.html.twig' %}
{% import 'macro/toast_macro.html.twig' as toasts %}

{% block title %}Hello FeedController!{% endblock %}

{% block body %}


<section class="body container mb-5">
<div class="mt-5 d-flex row justify-content-center">
    <div class="col-md-6">
        <div class="input-group mb-3">
        <div class="mt-2 me-5">
       
        </div>
            <input type="text" class="form-control border-end-1 border-start-1 rounded-5" placeholder="Quoi de neuf, {{ app.user.firstName }} ?" aria-label=">Quoi de neuf,  " aria-describedby="createPostToggle" data-bs-toggle="collapse" data-bs-target="#createPostForm" aria-expanded="false" aria-controls="createPostForm" style="cursor: pointer;">
            <span class="input-group-text bg-white border-0" id="createPostToggle" style="cursor: pointer;"><i class="fas fa-pencil-alt"></i></span>
        </div>
    </div>
</div>

<div class="collapse mt-3" id="createPostForm">
    <div class="create-post border rounded p-3 shadow-sm">
        {{ form_start(form) }}
            {{ form_widget(form.title, {'attr': {'placeholder': 'Titre', 'class': 'form-control mb-2'}}) }}
            {{ form_widget(form.Description, {'attr': {'placeholder': 'Exprimez-vous...', 'class': 'form-control mb-2'}}) }}
            {{ form_row(form.imageFile, {'attr': {'class': 'form-control mb-2'}}) }}
            <div class="d-flex justify-content-center">
                <button class="btn nm-Button w-75" type="submit">Publier</button>
            </div>
        {{ form_end(form) }}
    </div>
</div>

    <div class="row justify-content-center">
      <div class="col-12 col-md-8">
        {% for f in feeds %}
        <div class="card_s mt-5 border rounded shadow-sm">
          <div class="card-header d-flex align-items-center">
            <img src="https://via.placeholder.com/40" alt="{{ f.author.firstName }} {{ f.author.lastName }}" class="rounded-circle me-3">
            <div>
              <h6 class="card-title mb-0">
                <a href="{{ path('app_user', {id: f.author.id}) }}">{{ f.author.firstName }} {{ f.author.lastName }}</a>
              </h6>
              <small class="text-muted">Author</small>
            </div>
          </div>
          <img src="{{ vich_uploader_asset(f, 'imageFile') }}" class="card-img-top" alt="{{ f.title }}">
        
          <div class="card-body">
            <h5 class="card-title">{{ f.title }}</h5>
            <p class="card-text">{{ f.description }}</p>
          </div>
          <div class="card-footer d-flex justify-content-between align-items-center">
            <div>
              {% set userLiked = false %}
              {% for like in f.likes %}
                {% if like.user.id == app.user.id %}
                  {% set userLiked = true %}
                {% endif %}
              {% endfor %}
               <div class='commentMessages mt-5'>
            {% for message in app.flashes('success') %}
        {{ toasts.toast('success', message) }}
    {% endfor %}
    </div>
                 <a href="{{ path('app_feed_liked', {id: f.id}) }}" class="nm-Button-like {{ userLiked ? 'filled' : '' }}">
                <i class="fas fa-heart"></i> {{ f.likes|length }}
              </a>
            </div>
            <a href="#" class="btn fs-6" data-bs-toggle="collapse" data-bs-target="#comments-{{ f.id }}" aria-expanded="false" aria-controls="comments-{{ f.id }}">
              <i class="far fa-comment"></i> {{ f.commentss|length }} Commentaires
            </a>
            <a href="#" class="btn"><i class="far fa-share-square"></i> {{ f.shared }}</a>
          </div>
          <div class="collapse mt-3 p-2" id="comments-{{ f.id }}">
            {% for comment in f.commentss %}
              <div class="card mb-3">
                <div class="card-body bg-secondary-subtle">
                  
                  <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted"><h5> <a class="text-decoration-none text-dark" href="{{ path('app_user', {id: comment.userCommented.id}) }}">{{ comment.userCommented.firstName }} {{ comment.userCommented.lastName }}</a></h5> </small>
                  </div>
                  <p class="card-text">{{ comment.content }}</p>
                </div>
              </div>
            {% endfor %}
            <form action="{{ path('app_feed_comment', {id: f.id}) }}" method="post">
              <div class="form-group">
                <textarea class="form-control" name="comment" placeholder="Ajouter un commentaire..." required></textarea>
              </div>
              <button type="submit" class="nm-Button mt-2">Commenter</button>
            </form>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</section>
{% endblock %}
